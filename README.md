# Effective Mobile API

API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ –æ –ª—é–¥—è—Ö. –°–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ CRUD-–æ–ø–µ—Ä–∞—Ü–∏–∏, –∞ —Ç–∞–∫–∂–µ –æ–±–æ–≥–∞—â–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ (–≤–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª, –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å) —Å –ø–æ–º–æ—â—å—é –≤–Ω–µ—à–Ω–∏—Ö –ø—É–±–ª–∏—á–Ω—ã—Ö API.

##  –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

-   **CRUD API**
-   **–û–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö**
-   **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏—è**
-   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `.env`**
-   **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ Docker**
-   **–ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö**
-   **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger**
-   **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**

## üèõÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º —á–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã, —Ä–∞–∑–¥–µ–ª—è—è –ª–æ–≥–∏–∫—É –Ω–∞ —Å–ª–æ–∏ –¥–ª—è –ª—É—á—à–µ–π –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º–æ—Å—Ç–∏.

```
.
‚îú‚îÄ‚îÄ cmd/server/main.go    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ internal
‚îÇ   ‚îú‚îÄ‚îÄ config            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ httpserver        # HTTP-—Å–µ—Ä–≤–µ—Ä, —Ä–æ—É—Ç–∏–Ω–≥, —Ö–µ–Ω–¥–ª–µ—Ä—ã, middleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ handlers      # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ (CRUD)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ middleware    # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ª–æ–≥–≥–µ—Ä)
‚îÇ   ‚îú‚îÄ‚îÄ logger            # –ü–∞–∫–µ—Ç –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ model             # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö (—Å—É—â–Ω–æ—Å—Ç–∏)
‚îÇ   ‚îú‚îÄ‚îÄ service           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±–æ–≥–∞—â–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ enrichment
‚îÇ   ‚îî‚îÄ‚îÄ storage           # –°–ª–æ–π –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ       ‚îî‚îÄ‚îÄ pg            # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –¥–ª—è PostgreSQL
‚îú‚îÄ‚îÄ migrations            # SQL-–º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ docs                  # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Swagger
‚îú‚îÄ‚îÄ .env                  # –§–∞–π–ª —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–ø—Ä–∏–º–µ—Ä –Ω–∏–∂–µ)
‚îú‚îÄ‚îÄ Dockerfile            # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å–±–æ—Ä–∫–∏ Docker-–æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ docker-compose.yml    # –§–∞–π–ª –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ + –ë–î)
‚îî‚îÄ‚îÄ Makefile              # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å–±–æ—Ä–∫–∏, –∑–∞–ø—É—Å–∫–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏–π
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

-   **–Ø–∑—ã–∫**: Go
-   **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL
-   **–í–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ `net/http`
-   **–†–æ—É—Ç–µ—Ä**: –°–∞–º–æ–ø–∏—Å–Ω—ã–π —Ä–æ—É—Ç–µ—Ä –Ω–∞ –±–∞–∑–µ `net/http`
-   **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**: `godotenv`, `env`
-   **–ú–∏–≥—Ä–∞—Ü–∏–∏**: `golang-migrate`
-   **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API**: `swaggo/swag`
-   **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker, Docker Compose

## –ù–∞—á–∞–ª–æ —Ä–∞–±–æ—Ç—ã

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

-   [Go](https://golang.org/doc/install) (–≤–µ—Ä—Å–∏—è 1.21+)
-   [Docker](https://www.docker.com/get-started) –∏ [Docker Compose](https://docs.docker.com/compose/install/)
-   [golang-migrate](https://github.com/golang-migrate/migrate/tree/master/cmd/migrate)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ golang-migrate (–¥–ª—è macOS/Linux)
curl -L https://github.com/golang-migrate/migrate/releases/download/v4.17.0/migrate.linux-amd64.tar.gz | tar xvz
sudo mv migrate /usr/local/bin/
```

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1.  **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:**
    ```bash
    git clone <your-repository-url>
    cd <repository-name>
    ```

2.  **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
    –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –µ–≥–æ —Å–≤–æ–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

    –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ `.env`:
    ```env
    # –û—Ç–ª–∞–¥–∫–∞
    DEBUG=true

    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PostgreSQL
    DSN_PORT=5432
    DSN_USER=admin
    DSN_PASSWORD=123
    DSN_NAME=EffectiveMobileAPI
    DSN_HOST=localhost # –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ Docker Compose –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º—è —Å–µ—Ä–≤–∏—Å–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä 'db'

    # URL –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
    DATABASE_URL=postgres://admin:123@localhost:5432/EffectiveMobileAPI?sslmode=disable

    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è HTTP-—Å–µ—Ä–≤–µ—Ä–∞
    HTTP_ADDR=localhost:7007
    HTTP_TIMEOUT=4s
    HTTP_IDLE_TIMEOUT=30s
    HTTP_USER=admin # –≠—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏, –Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–ª—è Basic Auth
    HTTP_SERVER_PASSWORD=secret
    ```

### –°–ø–æ—Å–æ–±—ã –∑–∞–ø—É—Å–∫–∞

#### 1. –° –ø–æ–º–æ—â—å—é Docker Compose (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å–ø–æ—Å–æ–±)

```bash
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ .env DSN_HOST=db
docker-compose up --build
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:7007`.

#### 2. –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å –ø–æ–º–æ—â—å—é Makefile

1.  **–ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö, –∏ –µ–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç —É–∫–∞–∑–∞–Ω–Ω—ã–º –≤ `.env`.

2.  **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
    ```bash
    make migrate-up
    ```

3.  **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:**
    ```bash
    make run
    ```

##  Makefile –∫–æ–º–∞–Ω–¥—ã

-   `make build`: –°–æ–±—Ä–∞—Ç—å –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
-   `make run`: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–ø–æ—Å–ª–µ —Å–±–æ—Ä–∫–∏).
-   `make migrate-up`: –ü—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏.
-   `make migrate-down`: –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –ø—Ä–∏–º–µ–Ω–µ–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é.
-   `make clean`: –£–¥–∞–ª–∏—Ç—å —Å–æ–±—Ä–∞–Ω–Ω—ã–π –±–∏–Ω–∞—Ä–Ω–∏–∫.
-   `make fmt`: –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –ø—Ä–æ–µ–∫—Ç–∞.

##  API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–µ—Ä–≤–∏—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Swagger –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API. –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –ø–æ –∞–¥—Ä–µ—Å—É:

**[http://localhost:7007/swagger/index.html](http://localhost:7007/swagger/index.html)**

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥  | –ü—É—Ç—å             | –û–ø–∏—Å–∞–Ω–∏–µ                                                                  |
| :----- | :--------------- | :------------------------------------------------------------------------ |
| `GET`  | `/people`        | –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ª—é–¥–µ–π —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏.              |
| `POST` | `/people`        | –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞. –î–∞–Ω–Ω—ã–µ –æ–±–æ–≥–∞—â–∞—é—Ç—Å—è (–≤–æ–∑—Ä–∞—Å—Ç, –ø–æ–ª, –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å). |
| `PUT`  | `/people/{id}`   | –û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —á–µ–ª–æ–≤–µ–∫–∞ –ø–æ –µ–≥–æ ID.                                       |
| `DELETE`| `/people/{id}`  | –£–¥–∞–ª–∏—Ç—å —á–µ–ª–æ–≤–µ–∫–∞ –ø–æ –µ–≥–æ ID.                                               |
| `GET`  | `/health`        | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å–∞.                                       |

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`POST /people`)

```json
{
  "name": "Dmitriy",
  "surname": "Ivanov",
  "patronymic": "Sergeevich"
}
```

#### –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞

```json
{
    "id": 1,
    "message": "user added"
}
```

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`GET /people`)

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å query-–ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏:

`GET /people?age=30&gender=male&limit=10`